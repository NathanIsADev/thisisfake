<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Credits Vault ‚Äî Supabase Connected (Fixed)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">

<!-- ONLY ONE supabase UMD include -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>

<style>
  :root{
    --bg:#060102;
    --deep:#2a0000;
    --red:#b40000;
    --hot:#ff2a2a;
    --gold:#ffd66b;
    --muted:#b08b8b;
  }
  *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  html,body{height:100%;margin:0;background:
      radial-gradient(1200px 600px at 10% 10%, rgba(180,0,0,0.08), transparent 8%),
      radial-gradient(800px 600px at 90% 80%, rgba(255,180,100,0.03), transparent 8%),
      linear-gradient(180deg,#120002 0%, var(--bg) 40%, #0a0506 100%);
    color: #fff; overflow-x:hidden;}

/* top marquee */
.topbar{
  position:fixed;left:0;right:0;top:0;height:34px;display:flex;align-items:center;justify-content:center;
  background:linear-gradient(90deg, rgba(180,0,0,0.22), rgba(0,0,0,0.12));
  z-index:140;
  box-shadow:0 6px 30px rgba(0,0,0,0.6);
  overflow:hidden;
}
.marquee{
  display:inline-block;padding:6px 12px;border-radius:999px;font-weight:800;color:var(--gold);
  background:linear-gradient(90deg, rgba(255,210,110,0.06), rgba(255,255,255,0.02));
  animation:marq 6s linear infinite;
  letter-spacing:1px;
}
@keyframes marq { 0%{transform:translateX(0)} 100%{transform:translateX(-50%)}}

/* floating symbols */
.symbols{position:fixed;inset:0;pointer-events:none;z-index:0}
.symbols span{position:absolute;font-size:2.6rem;opacity:0.09;transform:translateY(120vh); animation:float linear infinite; filter:drop-shadow(0 10px 30px rgba(0,0,0,0.6));}
@keyframes float{from{transform:translateY(120vh) rotate(0deg)} to{transform:translateY(-120vh) rotate(720deg)}}

/* header */
.header{padding:120px 20px 40px;text-align:center;position:relative;z-index:2}
h1{font-size:clamp(2.8rem,6vw,4.2rem);margin:0;font-weight:900;letter-spacing:2px;text-shadow:0 0 30px rgba(255,40,40,0.16); color: #fff; animation:flicker 3.6s infinite;}
@keyframes flicker{0%{opacity:1}8%{opacity:.7}10%{opacity:1}20%{opacity:.85}100%{opacity:1}}
.lead{color:var(--muted);margin-top:12px;font-size:1.05rem}

/* balance chip */
.balance{display:inline-block;margin-top:18px;padding:10px 18px;border-radius:999px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent); box-shadow:0 8px 30px rgba(200,80,80,0.08); font-weight:800;color:var(--gold);letter-spacing:1px}
.status{display:block;margin-top:8px;font-size:0.78rem;color:var(--muted)}

/* Central CTA area */
.vault{margin:60px auto 40px;max-width:680px;padding:36px;border-radius:18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.15)); box-shadow: 0 40px 140px rgba(0,0,0,0.8);position:relative;z-index:2;overflow:hidden;}
.vault::before{content:"";position:absolute;inset:auto -20% -20% -20%;background:conic-gradient(from 90deg at 50% 50%, rgba(255,80,80,0.02), rgba(255,200,60,0.02)); transform:rotate(6deg);filter:blur(40px);opacity:0.9;pointer-events:none;}
.vault .sweep{position:absolute;inset:0;pointer-events:none;background:linear-gradient(90deg, transparent, rgba(255,255,255,0.06), transparent); transform:translateX(-110%);animation:shine 3.2s linear infinite}
@keyframes shine{from{transform:translateX(-110%)}50%{transform:translateX(110%)}to{transform:translateX(310%)}}
.vault h2{margin:0;font-size:2.2rem;letter-spacing:1px}
.priceRow{display:flex;align-items:center;justify-content:space-between;margin:14px 0;color:var(--muted)}
.priceRow .price{font-weight:900;color:var(--gold);font-size:1.15rem}

/* Buttons */
.btn{display:inline-block;padding:18px 26px;border-radius:14px;font-weight:900;border:none;cursor:pointer;font-size:1.25rem;letter-spacing:1px;position:relative;overflow:hidden;box-shadow:0 20px 60px rgba(180,20,20,0.18), 0 0 60px rgba(255,40,40,0.06);transition:transform .12s ease; background:#ff4b4b;color:#150000;}
.btn:active{transform:scale(.98)}
.ctaPrimary{width:100%;background:linear-gradient(90deg,var(--hot),#ff6b6b);color:#180000;box-shadow:0 0 40px rgba(255,40,40,0.5);animation:pulse 1.2s infinite}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.03)}100%{transform:scale(1)}}
.halo{position:absolute;inset:-30px;filter:blur(36px);opacity:.6;pointer-events:none;background:radial-gradient(circle at 50% 40%, rgba(255,200,60,0.14), transparent 25%)}
.badge{position:absolute;top:-18px;right:18px;background:var(--gold);color:#1a0a00;padding:7px 10px;border-radius:999px;font-weight:900;box-shadow:0 8px 30px rgba(255,200,80,0.12);transform:translateY(-6px)}
.flash{position:absolute;inset:-40px;border-radius:18px;pointer-events:none;opacity:.12;background:radial-gradient(circle at 30% 20%, rgba(255,220,100,0.12), transparent 6%), radial-gradient(circle at 70% 80%, rgba(255,80,80,0.06), transparent 20%)}

/* side pulses */
.side-pulse{position:fixed;right:-140px;top:20vh;width:400px;height:400px;border-radius:50%;background:conic-gradient(from 0deg, rgba(255,80,80,0.06), transparent 30%);filter:blur(60px);transform:rotate(14deg);z-index:1}
.side-pulse.left{left:-140px;right:auto;top:60vh;transform:rotate(-14deg)}

/* section and fake box */
.section{margin-top:160px;padding:120px 20px 220px;position:relative;z-index:2}
.grid{display:grid;grid-template-columns:1fr 420px;gap:36px;max-width:1100px;margin:0 auto;align-items:start}
.copy h3{font-size:2.1rem;margin:0 0 10px}
.copy p{color:var(--muted);line-height:1.6}
.fakeBox{background:linear-gradient(180deg,#1a0000,#0d0000);padding:26px;border-radius:14px;box-shadow:0 30px 100px rgba(0,0,0,0.7);position:relative;overflow:hidden}
.fakePrice{color:var(--muted);font-weight:800;margin-bottom:12px}
.fakePrice strong{color:var(--gold);font-size:1.15rem}

/* confetti pieces & coin particles */
.confetti-piece{position:fixed;width:10px;height:16px;pointer-events:none;z-index:200;border-radius:3px;transform-origin:center;opacity:1}
.coin{position:fixed;width:14px;height:14px;border-radius:50%;background:linear-gradient(180deg,var(--gold),#ffdd80);box-shadow:0 6px 18px rgba(0,0,0,0.4);pointer-events:none;z-index:190;}

/* sticky CTA bottom */
.sticky{position:fixed;left:18px;right:18px;bottom:24px;padding:12px;border-radius:14px;background:linear-gradient(90deg, rgba(180,0,0,0.12), rgba(0,0,0,0.28));display:flex;align-items:center;justify-content:space-between;gap:12px;z-index:160;backdrop-filter: blur(4px)}
.sticky .mini{font-weight:800;color:var(--gold);font-size:1rem}
.sticky button{min-width:220px}

/* responsive */
@media(max-width:880px){.grid{grid-template-columns:1fr; padding:0 18px} .sticky{left:10px;right:10px}}
/* small helper animations */
@keyframes shake{0%{transform:translateY(0)}25%{transform:translateY(-6px)}50%{transform:translateY(0)}75%{transform:translateY(-3px)}100%{transform:translateY(0)}}
.big-red{color:var(--hot);text-shadow:0 0 22px rgba(255,40,40,0.14);font-weight:900}
footer{padding:84px 20px;text-align:center;color:var(--muted);font-size:0.9rem}
</style>
</head>
<body>

<!-- top caution bar -->
<div class="topbar" id="topbar"><div class="marquee">‚ö†Ô∏è LIMITED TIME ‚Äî SPECIAL PRICE $0.01 ‚Äî LIMITED TIME ‚Äî SPECIAL PRICE $0.01</div></div>

<!-- floating symbols -->
<div class="symbols" aria-hidden="true">
  <span style="left:5%; animation-duration:14s; font-size:3.2rem">üçí</span>
  <span style="left:18%; animation-duration:19s; font-size:2.6rem">üíé</span>
  <span style="left:30%; animation-duration:16s; font-size:3.6rem">‚ë¶</span>
  <span style="left:46%; animation-duration:21s; font-size:2.8rem">üîî</span>
  <span style="left:62%; animation-duration:15s; font-size:3.4rem">‚ùå</span>
  <span style="left:78%; animation-duration:17s; font-size:3.0rem">üçã</span>
</div>

<div class="side-pulse" aria-hidden="true"></div>
<div class="side-pulse left" aria-hidden="true"></div>

<header class="header">
  <h1 class="big-red">CREDITS VAULT</h1>
  <div class="lead">Instant top-ups. Surge your balance. Experience the thrill of staying in play.</div>
  <div class="balance" id="balanceChip">BALANCE: <span id="credits">‚Äî</span>
    <span class="status" id="connStatus">Connecting‚Ä¶</span>
  </div>
</header>

<section class="vault" role="region" aria-label="Main purchase area">
  <div class="sweep"></div>
  <div style="display:flex;gap:20px;align-items:center;justify-content:space-between;position:relative">
    <div>
      <h2>+1000 CREDITS</h2>
      <div class="priceRow"><div class="priceSub">One-time offer</div><div class="price">$0.01</div></div>
      <div style="color:var(--muted);font-size:0.75rem">‚Ä¢No real purchase</div>
    </div>

    <div style="min-width:280px;position:relative">
      <div class="halo" aria-hidden="true"></div>
      <button id="mainAdd" class="btn ctaPrimary" aria-label="Add 1000 credits">ADD 1000 CREDITS</button>
      <div class="badge">HOT</div>
      <div class="flash" aria-hidden="true"></div>
    </div>
  </div>
</section>

<section class="section">
  <div class="grid">
    <div class="copy">
      <h3 class="big-red">Keep the Momentum</h3>
      <p>Running out of credits kills momentum. This quick top-up keeps you locked in and ready.</p>
      <p style="margin-top:14px;color:var(--muted)">We flood visuals with motion, color and light to nudge focus. It's loud by design.</p>
      <div style="margin-top:18px;color:var(--muted);font-size:0.95rem" id="lastAction">Last action: ‚Äî</div>
    </div>

    <aside class="fakeBox" aria-hidden="false">
      <div class="fakePrice">Special Price <strong>$0.01</strong></div>
      <button id="sideAdd" class="btn ctaPrimary" style="width:100%">ADD 1000 CREDITS</button>
      <div id="sparkWrap" class="spark-wrap" style="position:absolute;inset:0;pointer-events:none"></div>
    </aside>
  </div>
</section>

<footer>Demo only. No actual transactions occur. Hosted as single-file page.</footer>

<!-- sticky urgent CTA -->
<div class="sticky" role="dialog" aria-label="Quick add">
  <div class="mini">Instant +1000 ‚Ä¢ $0.01</div>
  <button id="stickyAdd" class="btn ctaPrimary">ADD 1000 CREDITS</button>
</div>

<!-- particle containers -->
<div id="confettiRoot"></div>
<div id="tempParticles"></div>

<script>
/* ===== SUPABASE CONFIG - same as your Python file ===== */
const SUPABASE_URL = "https://mldyqucmdxdldfcquupc.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1sZHlxdWNtZHhkbGRmY3F1dXBjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwMDI3MTYsImV4cCI6MjA4MTU3ODcxNn0.TAQtstBnsWBU9EY3YonZsfi6VbwJGqbhy3EM6CuncDY";
const PLAYER_NAME = "friend";
/* ====================================================================== */

/* Initialize client safely WITHOUT redeclaring a global named `supabase` */
let supabaseClient = null;
const loader = window.supabase || window.supabaseJs; // UMD might expose one of these
if (loader && typeof loader.createClient === 'function') {
  supabaseClient = loader.createClient(SUPABASE_URL, SUPABASE_KEY);
} else {
  console.error("Supabase UMD not found.");
}

/* minimal helpers and UI hooks */
const creditEl = document.getElementById('credits');
const connStatusEl = document.getElementById('connStatus');
const lastActionEl = document.getElementById('lastAction');
const confettiRoot = document.getElementById('confettiRoot');
const tempRoot = document.getElementById('tempParticles');

function setStatus(text, isError=false){
  connStatusEl.textContent = text;
  connStatusEl.style.color = isError ? '#ffb3b3' : '';
}

/* load balance */
async function loadBalance(){
  if (!supabaseClient) { setStatus('No DB client', true); creditEl.textContent = 'ERR'; return; }
  setStatus('Loading‚Ä¶');
  const { data, error } = await supabaseClient
    .from('player')
    .select('balance')
    .eq('name', PLAYER_NAME)
    .single();

  if (error) {
    console.error('Load error', error);
    setStatus('Load failed', true);
    creditEl.textContent = 'ERR';
    return;
  }
  creditEl.textContent = Number(data.balance).toLocaleString();
  setStatus('Connected');
}

/* add credits */
async function addCreditsToSupabase(amount = 1000){
  if (!supabaseClient) { setStatus('No DB client', true); return; }
  setStatus('Processing‚Ä¶');
  // simple read -> update
  const { data: read, error: readErr } = await supabaseClient
    .from('player')
    .select('balance')
    .eq('name', PLAYER_NAME)
    .single();

  if (readErr) { console.error('Read failed', readErr); setStatus('Read failed', true); return; }

  const newBal = Number(read.balance) + Number(amount);

  const { error: upErr } = await supabaseClient
    .from('player')
    .update({ balance: newBal })
    .eq('name', PLAYER_NAME);

  if (upErr) { console.error('Update failed', upErr); setStatus('Update failed', true); return; }

  creditEl.textContent = newBal.toLocaleString();
  setStatus('Connected');
  lastActionEl.textContent = `Last action: +${amount.toLocaleString()} credits`;
}

/* wire buttons */
function attachHandlers(){
  const main = document.getElementById('mainAdd');
  const side = document.getElementById('sideAdd');
  const sticky = document.getElementById('stickyAdd');
  main.addEventListener('click', ()=> addCreditsToSupabase(1000));
  side.addEventListener('click', ()=> addCreditsToSupabase(1000));
  sticky.addEventListener('click', ()=> addCreditsToSupabase(1000));
}

/* initial confetti (keeps visuals same) */
function spawnInitialConfetti(){
  const root = confettiRoot;
  const count = 60;
  for(let i=0;i<count;i++){
    const el = document.createElement('div');
    el.className = 'confetti-piece';
    const w = 6 + Math.round(Math.random()*12);
    const h = 8 + Math.round(Math.random()*18);
    el.style.width = w + 'px';
    el.style.height = h + 'px';
    const palette = ['#ffd66b','#ffdb98','#ffc85a','#ffe6b3','#ffd28a'];
    el.style.background = palette[Math.floor(Math.random()*palette.length)];
    el.style.left = (Math.random()*100) + 'vw';
    el.style.top = (-10 - Math.random()*12) + 'vh';
    const fall = 700 + Math.random()*900;
    setTimeout(()=> {
      el.style.transition = `top ${fall}ms linear, opacity 400ms linear, transform ${fall}ms linear`;
      el.style.top = (25 + Math.random()*18) + 'vh';
      el.style.opacity = 0.95;
      el.style.transform = 'rotate(' + (Math.random()*360) + 'deg)';
    }, 20 + Math.random()*200);
    setTimeout(()=> el.style.opacity = 0, fall - 120);
    el.addEventListener('transitionend', (ev)=> { if(ev.propertyName === 'opacity') el.remove(); });
    root.appendChild(el);
  }
}

/* On load */
window.addEventListener('load', async ()=>{
  spawnInitialConfetti();
  attachHandlers();
  await loadBalance();

  // fade out topbar after a moment (same behavior as before)
  setTimeout(()=> {
    const tb = document.getElementById('topbar');
    if(tb){ tb.style.transition = 'opacity 800ms linear, transform 800ms ease'; tb.style.opacity = 0; tb.style.transform = 'translateY(-14px)'; setTimeout(()=> tb.remove(), 900); }
  }, 4200);
});
</script>

</body>
</html>
